CREATE TABLE t_preparations (
	id INT PRIMARY KEY AUTO_INCREMENT,
	preparation_code VARCHAR(255) NOT NULL,
	preparation_type ENUM('NEW STORE', 'ADDITIONAL'),
	status ENUM('DRAFT', 'ASSIGNED', 'PICKING', 'READY', 'READY TO  DELIVERY', 'COMPLETED', 'REJECTED', 'CANCELLED') DEFAULT 'DRAFT',
	destination_id INT NOT NULL,
	created_id INT NOT NULL,
	worker_id INT NOT NULL,
	approved_id INT NOT NULL,
	location_id INT,
	total_box INT,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	updated_at DATETIME DEFAULT NULL,
	notes VARCHAR(255),
	FOREIGN KEY(location_id) REFERENCES t_locations(id),
	FOREIGN KEY(destination_id) REFERENCES t_locations(id),
	FOREIGN KEY(created_id) REFERENCES t_users(id),
	FOREIGN KEY(worker_id) REFERENCES t_users(id),
	FOREIGN KEY(approved_id) REFERENCES t_users(id)
);

CREATE TABLE t_preparation_logs(
	id int PRIMARY KEY AUTO_INCREMENT,
	preparation_id INT NOT NULL,
	from_status VARCHAR(255),
	to_status VARCHAR(255),
	updated_by INT NOT NULL,
	updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	notes VARCHAR(255),
	FOREIGN KEY(preparation_id) REFERENCES t_preparations(id),
	FOREIGN KEY(updated_by) REFERENCES t_users(id)
);

CREATE TABLE t_preparation_details (
	id INT PRIMARY KEY AUTO_INCREMENT,
	preparation_id INT NOT NULL,
	asset_model_id INT NOT NULL,
	status ENUM('PENDING', 'PICKED', 'CANCELLED', 'REJECTED') DEFAULT 'PENDING',
	purchase_order VARCHAR(255),
	quantity INT NOT NULL,
	FOREIGN KEY(preparation_id) REFERENCES t_preparations(id),
	FOREIGN KEY(asset_model_id) REFERENCES t_asset_models(id)
);

CREATE TABLE t_preparation_detail_items (
	id INT PRIMARY KEY AUTO_INCREMENT,
	preparation_detail_id INT NOT NULL,
	asset_id INT,
	quantity INT,
	scanned_at DATETIME DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY(preparation_detail_id) REFERENCES t_preparation_details(id),
	FOREIGN KEY(asset_id) REFERENCES t_assets(id),
	INDEX (asset_id)
);
